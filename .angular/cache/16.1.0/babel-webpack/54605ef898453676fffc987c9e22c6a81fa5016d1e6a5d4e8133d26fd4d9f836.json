{"ast":null,"code":"import { environment } from 'src/environments/environment';\nimport * as CryptoJS from 'crypto-js';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"../safe-resource-url-pipe\";\n// end: safe-resource-url.pipe.ts\nclass PaymentConfirmComponent {\n  ngAfterViewInit() {\n    console.log('ngAfterViewInit triggered.');\n  }\n  constructor(formBuilder, http) {\n    this.formBuilder = formBuilder;\n    this.http = http;\n    this.endpoint = environment.endpoint;\n    this.paymentForm = document.getElementById('payment_form');\n    this.checkoutForm = this.formBuilder.group({\n      access_key: 'c66502af927a3533bfa6d215394eda4c',\n      profile_id: 'B63C4A44-D1AE-4F14-B0D5-4FFC7813736F',\n      transaction_uuid: Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15),\n      signed_field_names: 'access_key,profile_id,transaction_uuid,signed_field_names,unsigned_field_names,signed_date_time,locale,transaction_type,reference_number,amount,currency',\n      unsigned_field_names: '',\n      signed_date_time: new Date(),\n      locale: 'en-US',\n      transaction_type: 'authorization',\n      amount: '25',\n      reference_number: '123456789',\n      signature: ''\n    });\n  }\n  submitForm($event) {\n    $event.stopPropagation();\n    const signature = this.sign(this.checkoutForm.value);\n    this.checkoutForm.controls['signature'].setValue(signature);\n    this.http.post(environment.endpoint, this.checkoutForm.value);\n    console.warn('Your order has been submitted', this.checkoutForm.value);\n    return true;\n  }\n  sign(params) {\n    console.log(params);\n    return this.signData(this.buildDataToSign(params), environment.SECRET_KEY);\n  }\n  signData(data, secretKey) {\n    const signature = CryptoJS.HmacSHA256(environment.HMAC_SHA256, secretKey);\n    const signatureBase = signature.toString(CryptoJS.enc.Base64);\n    console.log(signatureBase);\n    return signatureBase;\n  }\n  buildDataToSign(params) {\n    const signedFieldNames = params.signed_field_names.split(',');\n    const dataToSign = signedFieldNames.map(field => `${field}=${params[field]}`);\n    console.log('!!!!!!!!!!!');\n    console.log(this.commaSeparate(dataToSign));\n    return this.commaSeparate(dataToSign);\n  }\n  commaSeparate(dataToSign) {\n    return dataToSign.join(',');\n  }\n  onLoad() {\n    console.log('onLoad triggered.');\n    const signature = this.sign(this.checkoutForm.value);\n    this.checkoutForm.controls['signature'].setValue(signature);\n    console.warn(this.checkoutForm.value);\n  }\n}\nPaymentConfirmComponent.ɵfac = function PaymentConfirmComponent_Factory(t) {\n  return new (t || PaymentConfirmComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.HttpClient));\n};\nPaymentConfirmComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: PaymentConfirmComponent,\n  selectors: [[\"app-payment-confirm\"]],\n  decls: 29,\n  vars: 4,\n  consts: [[\"target\", \"frame\", \"action\", \"https://testsecureacceptance.cybersource.com/embedded/pay\", \"method\", \"POST\", 3, \"formGroup\", \"ngSubmit\"], [\"form\", \"\"], [\"type\", \"hidden\", \"formControlName\", \"access_key\"], [\"type\", \"hidden\", \"formControlName\", \"profile_id\"], [\"type\", \"hidden\", \"formControlName\", \"transaction_uuid\"], [\"type\", \"hidden\", \"formControlName\", \"signed_field_names\"], [\"type\", \"hidden\", \"formControlName\", \"unsigned_field_names\"], [\"type\", \"hidden\", \"formControlName\", \"signed_date_time\"], [\"type\", \"hidden\", \"formControlName\", \"locale\"], [\"for\", \"transaction_type\"], [\"id\", \"transaction_type\", \"type\", \"text\", \"formControlName\", \"transaction_type\"], [\"for\", \"amount\"], [\"id\", \"amount\", \"type\", \"text\", \"formControlName\", \"amount\"], [\"for\", \"reference_number\"], [\"id\", \"reference_number\", \"type\", \"text\", \"formControlName\", \"reference_number\"], [\"type\", \"submit\", 1, \"button\"], [\"title\", \"Payment Frame\", \"name\", \"sa_iframe\", \"src\", \"iframe.jpg\", \"id\", \"sa_iframe\", \"height\", \"430\", \"width\", \"600\"], [\"width\", \"400\", \"height\", \"400\", \"id\", \"frame\", \"name\", \"frame\", \"frameborder\", \"0\", 1, \"custom-frame\", 3, \"src\", \"load\"], [\"frame\", \"\"]],\n  template: function PaymentConfirmComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"p\");\n      i0.ɵɵtext(1, \"Payment Details\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(2, \"form\", 0, 1);\n      i0.ɵɵlistener(\"ngSubmit\", function PaymentConfirmComponent_Template_form_ngSubmit_2_listener($event) {\n        return ctx.submitForm($event);\n      });\n      i0.ɵɵelement(4, \"input\", 2)(5, \"input\", 3)(6, \"input\", 4)(7, \"input\", 5)(8, \"input\", 6)(9, \"input\", 7)(10, \"input\", 8);\n      i0.ɵɵelementStart(11, \"div\")(12, \"label\", 9);\n      i0.ɵɵtext(13, \" transaction_type \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(14, \"input\", 10);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(15, \"div\")(16, \"label\", 11);\n      i0.ɵɵtext(17, \" amount \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(18, \"input\", 12);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(19, \"div\")(20, \"label\", 13);\n      i0.ɵɵtext(21, \" reference_number \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(22, \"input\", 14);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(23, \"button\", 15);\n      i0.ɵɵtext(24, \"Purchase\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelement(25, \"iframe\", 16);\n      i0.ɵɵelementStart(26, \"iframe\", 17, 18);\n      i0.ɵɵlistener(\"load\", function PaymentConfirmComponent_Template_iframe_load_26_listener() {\n        return ctx.onLoad();\n      });\n      i0.ɵɵpipe(28, \"safeResourceUrl\");\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"formGroup\", ctx.checkoutForm);\n      i0.ɵɵadvance(24);\n      i0.ɵɵproperty(\"src\", i0.ɵɵpipeBind1(28, 2, ctx.endpoint), i0.ɵɵsanitizeResourceUrl);\n    }\n  },\n  dependencies: [i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i3.SafeResourceUrlPipe],\n  styles: [\"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});\nexport { PaymentConfirmComponent };","map":{"version":3,"names":["environment","CryptoJS","PaymentConfirmComponent","ngAfterViewInit","console","log","constructor","formBuilder","http","endpoint","paymentForm","document","getElementById","checkoutForm","group","access_key","profile_id","transaction_uuid","Math","random","toString","substring","signed_field_names","unsigned_field_names","signed_date_time","Date","locale","transaction_type","amount","reference_number","signature","submitForm","$event","stopPropagation","sign","value","controls","setValue","post","warn","params","signData","buildDataToSign","SECRET_KEY","data","secretKey","HmacSHA256","HMAC_SHA256","signatureBase","enc","Base64","signedFieldNames","split","dataToSign","map","field","commaSeparate","join","onLoad","i0","ɵɵdirectiveInject","i1","FormBuilder","i2","HttpClient","selectors","decls","vars","consts","template","PaymentConfirmComponent_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵlistener","PaymentConfirmComponent_Template_form_ngSubmit_2_listener","ɵɵelement","PaymentConfirmComponent_Template_iframe_load_26_listener","ɵɵadvance","ɵɵproperty","ɵɵpipeBind1","ɵɵsanitizeResourceUrl"],"sources":["C:\\projects\\cybersource_sa_angular\\cybersource_sa\\src\\app\\payment-confirm\\payment-confirm.component.ts","C:\\projects\\cybersource_sa_angular\\cybersource_sa\\src\\app\\payment-confirm\\payment-confirm.component.html"],"sourcesContent":["import { Component, Pipe, PipeTransform } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { environment } from 'src/environments/environment';\nimport * as CryptoJS from 'crypto-js';\nimport { FormBuilder } from '@angular/forms';\nimport { DomSanitizer } from '@angular/platform-browser';\n\n// end: safe-resource-url.pipe.ts\n@Component({\n  selector: 'app-payment-confirm',\n  templateUrl: './payment-confirm.component.html',\n  styleUrls: ['./payment-confirm.component.scss']\n})\nexport class PaymentConfirmComponent {\n  endpoint = environment.endpoint;\n  paymentForm = document.getElementById('payment_form') as HTMLFormElement;\n  checkoutForm = this.formBuilder.group({\n    access_key: 'c66502af927a3533bfa6d215394eda4c',\n    profile_id: 'B63C4A44-D1AE-4F14-B0D5-4FFC7813736F',\n    transaction_uuid: Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15),\n    signed_field_names: 'access_key,profile_id,transaction_uuid,signed_field_names,unsigned_field_names,signed_date_time,locale,transaction_type,reference_number,amount,currency',\n    unsigned_field_names: '',\n    signed_date_time:  new Date(),\n    locale:  'en-US',\n    transaction_type: 'authorization',\n    amount: '25',\n    reference_number: '123456789',\n    signature: ''\n  });\n  ngAfterViewInit() {\n    console.log('ngAfterViewInit triggered.');    \n  }\n  constructor(    \n    private formBuilder: FormBuilder, private http: HttpClient\n  ) {}\n\n  submitForm($event: any): boolean {            \n      $event.stopPropagation();    \n      const signature = this.sign(this.checkoutForm.value);\n      this.checkoutForm.controls['signature'].setValue(signature);\n      this.http.post(environment.endpoint, this.checkoutForm.value);\n      console.warn('Your order has been submitted', this.checkoutForm.value);\n      return true;\n  }\n\n  public sign(params: any): string {\n      console.log(params);\n      return this.signData(this.buildDataToSign(params), environment.SECRET_KEY);\n  }\n\n  public signData(data: string, secretKey: string): string {\n      const signature = CryptoJS.HmacSHA256(environment.HMAC_SHA256, secretKey);\n      const signatureBase = signature.toString(CryptoJS.enc.Base64);\n      console.log(signatureBase);\n      return signatureBase;\n  }\n\n  public buildDataToSign(params: any): string {\n      const signedFieldNames = params.signed_field_names.split(',');\n      const dataToSign = signedFieldNames.map((field: string) => `${field}=${params[field]}`);\n      console.log('!!!!!!!!!!!');\n      console.log(this.commaSeparate(dataToSign));\n      return this.commaSeparate(dataToSign);\n  }\n\n  public commaSeparate(dataToSign: string[]): string {\n      return dataToSign.join(',');\n  }\n\n  onLoad() {\n    console.log('onLoad triggered.');\n    const signature = this.sign(this.checkoutForm.value);\n    this.checkoutForm.controls['signature'].setValue(signature);\n    console.warn(this.checkoutForm.value);\n  }\n}\n","<p>Payment Details</p>\n\n\n<form [formGroup]=\"checkoutForm\" target=\"frame\" action=\"https://testsecureacceptance.cybersource.com/embedded/pay\" #form method=\"POST\" (ngSubmit)=\"submitForm($event)\">\n    <input type=\"hidden\" formControlName=\"access_key\">\n    <input type=\"hidden\" formControlName=\"profile_id\">\n    <input type=\"hidden\" formControlName=\"transaction_uuid\">\n    <input type=\"hidden\" formControlName=\"signed_field_names\">\n    <input type=\"hidden\" formControlName=\"unsigned_field_names\">\n    <input type=\"hidden\" formControlName=\"signed_date_time\">\n    <input type=\"hidden\" formControlName=\"locale\">\n    <div>\n      <label for=\"transaction_type\">\n        transaction_type\n      </label>\n      <input id=\"transaction_type\" type=\"text\" formControlName=\"transaction_type\">\n    </div>\n  \n    <div>\n      <label for=\"amount\">\n        amount\n      </label>\n      <input id=\"amount\" type=\"text\" formControlName=\"amount\">\n    </div>\n  \n    <div>\n        <label for=\"reference_number\">\n            reference_number\n        </label>\n        <input id=\"reference_number\" type=\"text\" formControlName=\"reference_number\">\n    </div>\n    <button class=\"button\" type=\"submit\">Purchase</button>\n  \n  </form>\n\n  <iframe title=\"Payment Frame\" name=\"sa_iframe\" src=\"iframe.jpg\" id=\"sa_iframe\" height=\"430\" width=\"600\"></iframe> \n  <iframe class=\"custom-frame\" #frame width=\"400\" height=\"400\" id=\"frame\" name=\"frame\" frameborder=\"0\" [src]=\"endpoint | safeResourceUrl\" (load)=\"onLoad()\"></iframe>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}